#!/usr/bin/env bash
# This script groups visitors by IP and HTTP status code and displays the data

process_log_file() {
  filename="$1"

  if [[ ! -f "$filename" ]]; then
    echo "Error: Log file not found"
    echo "(26 chars long)"
    return
  fi

  awk '
  BEGIN {
    found_header = 0
    char_count = 0
    error_message = "Error: Log file not found\n(26 chars long)"
  }
  {
    if (NR == 1) {
      if ($0 ~ /^2023/) {
        found_header = 1
        header = $0
        char_count += length($0) + 1
      } else {
        print error_message
        exit
      }
    } else {
      lines[NR-1] = $0
      char_count += length($0) + 1
    }
  }
  END {
    if (!found_header || length(lines) == 0) {
      print error_message
    } else {
      print FILENAME
      print header
      print "msg - [Got]"
      for (line in lines) {
        print lines[line]
      }
      print "(" char_count " chars long)"
    }
  }
  ' "$filename"
}

# Example usage:
process_log_file 'file_0'
process_log_file 'file_1'
process_log_file 'file_2'
process_log_file 'file_3'
