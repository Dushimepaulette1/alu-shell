#!/usr/bin/env bash
# This script groups visitors by IP and HTTP status code and displays the data

process_log_file() {
  filename="$1"

  if [[ ! -f "$filename" ]]; then
    echo "Error: Log file not found"
    echo "(26 chars long)"
    return
  fi

  awk '
  BEGIN {
    header_found = 0
    line_count = 0
    char_count = 0
    error_message = "Error: Log file not found\n(26 chars long)"
  }
  {
    if (line_count == 0 && $0 ~ /^2023/) {
      header = $0
      header_found = 1
      char_count += length($0) + 1
    } else {
      lines[line_count] = $0
      char_count += length($0) + 1
    }
    line_count++
  }
  END {
    if (header_found == 0 || line_count == 1) {
      print error_message
    } else {
      print FILENAME
      print header
      print "msg - [Got]"
      for (i = 1; i < line_count; i++) {
        print lines[i]
      }
      print "(" char_count " chars long)"
    }
  }
  ' "$filename"
}

# Example usage:
process_log_file 'file_0'
process_log_file 'file_1'
process_log_file 'file_2'
process_log_file 'file_3'
